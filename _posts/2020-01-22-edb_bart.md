---
published: true
layout: single
title: "EDB BART 소개"
category: PostgreSQL
comments: false
---

![wal_segment_file](/assets/bart_achi.png)
> Image from [BARMAN Official Manual](http://docs.pgbarman.org/release/2.10/)


**B**ackup **A**nd **R**ecovery **T**ool 
----------------------------------------
* 복수의 EDB 서버를 대상으로 complete, hot, physical 백업을 지원
* 풀 베이스 백업(full base backup)과 블록 레벨(block-level)의 증분 백업 2가지 타입을 지원 
* 로컬 또는 리모트 호스트를 대상으로 백업과 복구 
* 사용자가 정의한대로 백업 유지 가능(retention policy support)
* 압축 백업 지원 
* 백업 데이터 체크섬 정합성 지원
* 백업 상세 정보가 직관적으로 이해되도록 구성    
* 좀더 간단하게 Point-in-time 복구가 가능  


## 지원하는 플랫폼 
* CentOS 6.X 또는 7.X
* Red Hat 엔터프라이즈 리눅스 6.X 또는 7.X
* Ubuntu 18.04 (Debian 9.X)

## 지원하는 EDB & PG 버전 
* EDB 9.5, 9.6, 10, 11, 12 
* PG 9.5, 9.6, 10, 11, 12 


## 설치하기 
A 호스트는 standalone EDB가 기동중인 호스트이고 B 호스트는 BART 호스트 서버로 A 호스트와는 물리적으로 별개이며 A 호스트의 EDB를 백업 대상으로 한다는 것을 전제로 진행한다. 

* A 호스트(EDB 서버) IP 172.17.0.2 
* B 호스트(BART 호스트) IP 172.17.0.3 

## B 호스트에서 진행해야 하는 설치 프로세스 
B 호스트에 반드시 edb 서버를 설치하는 것은 아니다. 다만 긴급 상황이 발생하여 마스터를 대신해 BART로 받아놓은 백업본을 가지고 EDB 프로세스를 올리는 상황까지 고려되었다면 EDB 서버 패키지를 설치해야 한다. 이 글에서는 BART 호스트로 쓰이는 B 호스트는 어디까지나 EDB 마스터 서버의 백업 호스트로서만 기능한다는 전제 아래 작성되었기에 EDB 서버 패키지를 설치하는 것은 배제한다. 

그렇더라도 edb-as1*-server-client는 반드시 설치되어 있어야 한다. 클라이언트를 먼저 설치한 후에 BART 패키지를 설치한다. 

## On 호스트 B

```bash 
# root user 
yum install -y edb-as11-server-client
yum install -y edb-bart 

# pg_basebackup 존재 여부 확인 
ls -al /usr/edb/as11/bin/pg_basebackup
```
BART 백업 카탈로그의 소유자이자 BART 유틸리티를 실행할 bart 유저를 생성한다. (enterprisedb OS 유저를 bart 유저로서 사용할 수도 있다)
```bash 
# root user
groupadd bart
useradd -g bart bart
passwd bart
```
bart OS 유저의 profile에 환경변수를 등록한다. 
```bash
# bart user's bash_profile
export LD_LIBRARY_PATH=/usr/edb/as11/lib:$LD_LIBRARY_PATH
```

BART 백업 디렉토리를 생성한다.
```bash
mkdir /opt/backup
chown bart:bart /opt/backup
chgrp bart /opt/backup
chmod 700 /opt/backup
```

$BART_HOME(/usr/edb/bart) 하위의 etc 디렉토리에 있는 템플릿을 이용하여 bart.cfg 설정파일 만든 후 적절한 값으로 파라미터들을 수정한다. [BART] 에는 BART 호스트에 관한 정보를 입력하고 EDB 호스트에 대한 항목은 적절한 alias로 네이밍을 하고나서 그 호스트에 관한 정보를 입력한다. 
```bash 
[BART]
bart_host= bart@172.17.0.3
backup_path = /opt/backup
pg_basebackup_path = /usr/edb/as11/bin/pg_basebackup
logfile = /tmp/bart.log
scanner_logfile = /tmp/bart_scanner.log
thread_count = 5

[EPAS11]
host = 172.17.0.2
port = 5444
user = enterprisedb
cluster_owner = enterprisedb
description = "EPAS 11 Server"
allow_incremental_backups = enabled
backup_name = edb11_%year-%month-%dayT%hour:%minute:%second
```



